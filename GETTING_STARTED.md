# Getting Started with Moment-o7 Development

This guide helps you set up the Moment-o7 Zotero plugin for development and understand the build process.

## Quick Start

```bash
# Clone the repository
git clone https://github.com/dawsonmv/zotero-moment-o7.git
cd zotero-moment-o7

# Install dependencies and build
npm install

# You're done! The build process runs automatically.
```

After `npm install`, the `.scaffold/build/moment-o7.xpi` file will be automatically generated.

## Understanding the Build System

### .scaffold Directory

The `.scaffold` directory contains build artifacts:
- **`.scaffold/build/moment-o-7.xpi`** - The compiled plugin file (this is what you install in Zotero)
- **`.scaffold/build/addon/`** - Compiled addon resources
- **`.scaffold/build/update-beta.json`** and **`update.json`** - Update manifests

This directory is **git-ignored** because it's generated by the build process, not part of source code.

### Why It's Ignored

The `.scaffold` directory is in `.gitignore` because:
1. Build artifacts shouldn't be committed to version control
2. Artifact size inflates the repository
3. Each developer/CI environment should generate artifacts locally
4. This matches standard practices for compiled projects

### Automatic Build on Install

The `postinstall` script in `package.json` automatically runs `npm run build` after dependencies are installed. This ensures the `.xpi` file is always available.

## Development Workflow

### Run in Development Mode (with hot reload)

```bash
npm start
```

This launches the development server with hot-reloading enabled. Changes to source files trigger automatic rebuilds.

### Build for Testing/Distribution

```bash
npm run build
```

This creates an optimized build in `.scaffold/build/`.

### Run Tests

```bash
npm test                # Run all tests
npm run test:watch      # Run tests in watch mode
npm run test:coverage   # Run with coverage report
```

### Linting and Formatting

```bash
npm run lint:check      # Check code style
npm run lint:fix        # Auto-fix style issues
```

## Installing the Plugin in Zotero

### From Development Build

1. Build the plugin:
   ```bash
   npm run build
   ```

2. The `.xpi` file will be at `.scaffold/build/moment-o-7.xpi`

3. In Zotero 7:
   - Go to **Tools â†’ Add-ons**
   - Click the âš™ï¸ gear icon
   - Select **Install Add-on From File...**
   - Choose `.scaffold/build/moment-o-7.xpi`

### From Development Server

For hot-reloading development:

1. Run `npm start`

2. The development server URL will be displayed (typically `http://localhost:8888`)

3. In Zotero, go to **Tools â†’ Moment-o7 â†’ Debug Mode** and enable developer logging to see real-time updates

## Troubleshooting

### Missing .scaffold directory or .xpi file

**Problem**: After cloning, you don't see `.scaffold/build/moment-o-7.xpi`

**Solution**:
```bash
npm install              # Runs postinstall script
# OR manually:
npm run build
```

The `.scaffold` directory is git-ignored because it contains generated build artifacts, not source code. It's created by running the build command.

### Build Fails

**Problem**: `npm run build` returns an error

**Solution**:
1. Clear the build cache:
   ```bash
   rm -rf .scaffold
   npm run build
   ```

2. Verify TypeScript compiles:
   ```bash
   npx tsc --noEmit
   ```

3. Check for TypeScript errors in your code

### Changes Not Showing in Zotero

**Using Development Mode** (`npm start`):
1. Changes auto-reload via the development server
2. Check the browser console for errors

**Using Manual Builds**:
1. Run `npm run build` to rebuild
2. Uninstall the plugin in Zotero
3. Reinstall the newly built `.xpi` file

## Project Structure

```
zotero-momento7-new/
â”œâ”€â”€ src/                    # Source code (TypeScript)
â”‚   â”œâ”€â”€ index.ts           # Entry point
â”‚   â”œâ”€â”€ modules/           # Feature modules
â”‚   â”‚   â”œâ”€â”€ archive/       # Archive service implementations
â”‚   â”‚   â”œâ”€â”€ monitoring/    # Observability
â”‚   â”‚   â”œâ”€â”€ preferences/   # Settings
â”‚   â”‚   â””â”€â”€ memento/       # RFC 7089 Memento Protocol
â”‚   â””â”€â”€ utils/             # Shared utilities
â”œâ”€â”€ addon/                 # Zotero addon manifest files
â”‚   â”œâ”€â”€ bootstrap.js       # Plugin bootstrap
â”‚   â”œâ”€â”€ manifest.json      # Plugin metadata
â”‚   â”œâ”€â”€ prefs.js          # Preferences UI
â”‚   â””â”€â”€ locale/           # Localization strings
â”œâ”€â”€ tests/                 # Jest unit tests
â”œâ”€â”€ .scaffold/            # BUILD OUTPUT (git-ignored)
â”‚   â””â”€â”€ build/
â”‚       â””â”€â”€ moment-o-7.xpi  # The compiled plugin
â”œâ”€â”€ package.json          # Node.js configuration
â”œâ”€â”€ zotero-plugin.config.ts # Build configuration
â””â”€â”€ README.md            # Project documentation
```

## Key Concepts

### Build Artifacts vs Source Code

- **Source Code** (committed to git):
  - TypeScript files in `src/`
  - Addon templates in `addon/`
  - Configuration files (`package.json`, `zotero-plugin.config.ts`)

- **Build Artifacts** (git-ignored, generated):
  - `.scaffold/build/` directory
  - Compiled JavaScript
  - Packaged `.xpi` file
  - Update manifests

### Why postinstall Script?

The `postinstall` script in `package.json` ensures:
1. Fresh clones work without extra steps
2. Developers always have a valid `.xpi` file
3. CI/CD pipelines build automatically
4. New team members don't need manual setup

## Next Steps

1. **Read the main README**: `cat README.md`
2. **Understand the architecture**: See `CLAUDE.md`
3. **Explore the codebase**: Start in `src/index.ts`
4. **Run tests**: `npm test`
5. **Start developing**: `npm start`

## Getting Help

- **Issues**: Report bugs at https://github.com/dawsonmv/zotero-moment-o7/issues
- **Documentation**: Check `CLAUDE.md` for architecture details
- **Tests**: Run `npm test` to verify your changes don't break anything

## Common Commands Reference

```bash
# Setup
npm install              # Install dependencies + build

# Development
npm start               # Dev server with hot reload
npm run build           # Production build
npm run build --        # Clear build first: rm -rf .scaffold && npm run build

# Testing
npm test               # Run all tests
npm run test:coverage  # Coverage report
npm run test:watch     # Watch mode

# Code Quality
npm run lint:check     # Check formatting and linting
npm run lint:fix       # Auto-fix issues

# Maintenance
npm run update-deps    # Update dependencies
npm run release        # Create release (requires version bump)
```

---

**Last Updated**: 2026-01-01

Happy coding! ğŸ‰
